<div class="flex flex-col items-center justify-center py-16 px-6">
  <!-- Saudação -->
  <h1 class="text-5xl font-bold text-white mb-6 text-center">
  <%# #BOTAO PRA FECHAR O FLASH NOTICE ETC e ajustar tela de metas %>
    Bem-vindo de volta, <span class="text-loveRed"><%= current_user.couple.partner_1 %></span> 
    e <span class="text-loveRed"><%= current_user.couple.partner_2 %></span>!
  </h1>
  <p class="text-lg mb-8 text-gray-300 text-center">Que tal organizar mais um momento especial juntos?</p>

  <!-- Contador de Tempo Dinâmico -->
<% next_event = current_user.couple.events.order(date: :asc).where("date > ?", Date.today).first %>
<div class="mb-8 gap-6 flex justify-center flex-wrap">
  <% if next_event %>
    <div id="countdown" class="bg-loveRed text-white px-8 py-6 rounded-lg font-semibold shadow-xl flex items-center gap-4 transition-all transform hover:scale-105 space-x-4">
      <div class="flex flex-col items-center justify-center">
        <i class="fas fa-calendar-check text-4xl mb-4"></i> <!-- Ícone para próximo evento -->
        <h2 class="text-2xl font-bold mb-2">Próximo Evento: <%= next_event.title %></h2>
        <p class="text-lg mt-2 mb-4">Faltam:</p>
      </div>
      
      <!-- Exibição do Contador -->
      <div class="flex space-x-4">
        <div class="flex flex-col items-center bg-gray-700 p-4 rounded-lg">
          <span class="text-4xl font-bold text-loveRed" id="days">00</span>
          <span class="text-sm text-gray-400">Dias</span>
        </div>

        <div class="flex flex-col items-center bg-gray-700 p-4 rounded-lg">
          <span class="text-4xl font-bold text-loveRed" id="hours">00</span>
          <span class="text-sm text-gray-400">Horas</span>
        </div>

        <div class="flex flex-col items-center bg-gray-700 p-4 rounded-lg">
          <span class="text-4xl font-bold text-loveRed" id="minutes">00</span>
          <span class="text-sm text-gray-400">Minutos</span>
        </div>

        <div class="flex flex-col items-center bg-gray-700 p-4 rounded-lg">
          <span class="text-4xl font-bold text-loveRed" id="seconds">00</span>
          <span class="text-sm text-gray-400">Segundos</span>
        </div>
      </div>
    </div>
  <% else %>
    <div class="bg-loveRed text-white px-6 py-3 rounded-md font-semibold shadow-md">
      <p class="text-lg">Você não tem eventos futuros registrados.</p>
    </div>
  <% end %>
</div>

  <!-- Botões para Eventos e Metas -->
  <div class="mb-8 gap-6 flex justify-center flex-wrap">
    <%= link_to new_couple_event_path(current_user.couple.slug), class: "bg-loveRed text-white px-6 py-3 rounded-md font-semibold hover:bg-red-600 shadow-md flex items-center gap-2 transition-all transform hover:scale-105" do %>
      <i class="fas fa-calendar-alt"></i> <!-- Ícone para evento -->
      Adicionar Novo Evento
    <% end %>
    <%= link_to couple_events_path(current_user.couple.slug), class: "bg-loveRed text-white px-6 py-3 rounded-md font-semibold hover:bg-red-600 shadow-md flex items-center gap-2 transition-all transform hover:scale-105" do %>
      <i class="fas fa-calendar-check"></i> <!-- Ícone para ver eventos -->
      Ver Todos os Eventos
    <% end %>
    <%= link_to new_couple_goal_path(current_user.couple.slug), class: "bg-green-500 text-white px-6 py-3 rounded-md font-semibold hover:bg-green-600 shadow-md flex items-center gap-2 transition-all transform hover:scale-105" do %>
      <i class="fas fa-bullseye"></i> <!-- Ícone para metas -->
      Adicionar Nova Meta
    <% end %>
    <%= link_to couple_goals_path(current_user.couple.slug), class: "bg-green-500 text-white px-6 py-3 rounded-md font-semibold hover:bg-green-600 shadow-md flex items-center gap-2 transition-all transform hover:scale-105" do %>
      <i class="fas fa-trophy"></i> <!-- Ícone para ver metas -->
      Ver Todas as Metas
    <% end %>
  </div>

  <!-- Estatísticas do Casal -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl mb-12">
    <!-- Número de Eventos -->
    <div class="p-6 bg-gray-800 rounded-lg shadow-md">
      <h3 class="text-xl font-bold text-loveRed mb-2 flex items-center gap-2">
        <i class="fas fa-calendar-day"></i> Eventos Registrados
      </h3>
      <p class="text-4xl font-bold text-white"><%= current_user.couple.events.count %></p>
      <p class="text-gray-400 mt-2">Você já registrou <%= current_user.couple.events.count %> momentos incríveis juntos.</p>
    </div>

    <!-- Próximo Evento -->
    <div class="p-6 bg-gray-800 rounded-lg shadow-md">
      <h3 class="text-xl font-bold text-loveRed mb-2 flex items-center gap-2">
        <i class="fas fa-calendar-check"></i> Próximo Evento
      </h3>
      <% if next_event %>
        <p class="text-2xl font-bold text-white"><%= next_event.title %></p>
        <p class="text-gray-400 mt-2"><%= next_event.date.strftime("%d/%m/%Y") %></p>
      <% else %>
        <p class="text-gray-400">Você não tem eventos futuros registrados.</p>
      <% end %>
    </div>

    <!-- Eventos Concluídos -->
    <div class="p-6 bg-gray-800 rounded-lg shadow-md">
      <h3 class="text-xl font-bold text-loveRed mb-2 flex items-center gap-2">
        <i class="fas fa-check-circle"></i> Eventos Concluídos
      </h3>
      <% past_events_count = current_user.couple.events.where("date < ?", Date.today).count %>
      <p class="text-4xl font-bold text-white"><%= past_events_count %></p>
      <p class="text-gray-400 mt-2">Esses são os momentos especiais que já passaram, mas continuam em sua memória.</p>
    </div>

    <!-- Metas do Casal -->
    <% total_goals = current_user.couple.goals.count %>
    <% achieved_goals = current_user.couple.goals.where(achieved: true).count %>
    <% pending_goals = total_goals - achieved_goals %>
    <div class="p-6 bg-gray-800 rounded-lg shadow-md">
      <h3 class="text-xl font-bold text-green-400 mb-2 flex items-center gap-2">
        <i class="fas fa-bullseye"></i> Metas do Casal
      </h3>
      <p class="text-4xl font-bold text-white"><%= total_goals %></p>
      <p class="text-gray-400 mt-2">Vocês têm <%= total_goals %> metas registradas, sendo:</p>
      <ul class="text-gray-300 mt-2 space-y-2">
        <li>✅ <strong><%= achieved_goals %></strong> metas atingidas.</li>
        <li>⏳ <strong><%= pending_goals %></strong> metas pendentes.</li>
      </ul>
    </div>
  </div>

  <!-- Últimos Eventos -->
  <div class="w-full max-w-4xl">
    <h2 class="text-2xl font-bold mb-4">Últimos Eventos</h2>
    <% if current_user.couple.events.any? %>
      <ul class="space-y-4">
        <% current_user.couple.events.limit(3).order(created_at: :desc).each do |event| %>
          <li class="bg-gray-800 p-4 rounded-lg">
            <h3 class="text-lg font-bold"><%= event.title %></h3>
            <p class="text-sm text-gray-400"><%= event.date.strftime("%d/%m/%Y") %></p>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-center text-gray-400 mt-4">Você ainda não tem eventos cadastrados. 
        <%= link_to "Crie seu primeiro evento", new_couple_event_path(current_user.couple.slug), class: "text-loveRed underline" %>
      </p>
    <% end %>
  </div>
</div>

<script>
  if (typeof countdownInterval === 'undefined') {
    var countdownInterval;
  }

  function updateCountdown() {
    const targetDate = new Date("<%= next_event&.date.to_json.delete_prefix('"').delete_suffix('"') %>").getTime();
    const now = new Date().getTime();
    const timeRemaining = Math.abs(targetDate - now);

    const totalSeconds = Math.floor(timeRemaining / 1000);
    const days = Math.floor(totalSeconds / (60 * 60 * 24));
    const hours = Math.floor((totalSeconds % (60 * 60 * 24)) / (60 * 60));
    const minutes = Math.floor((totalSeconds % (60 * 60)) / 60);
    const seconds = Math.floor(totalSeconds % 60);

    const daysElement = document.getElementById('days');
    const hoursElement = document.getElementById('hours');
    const minutesElement = document.getElementById('minutes');
    const secondsElement = document.getElementById('seconds');

    if (daysElement && hoursElement && minutesElement && secondsElement) {
      daysElement.innerHTML = days;
      hoursElement.innerHTML = hours;
      minutesElement.innerHTML = minutes;
      secondsElement.innerHTML = seconds;
    } else {
      clearInterval(countdownInterval);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const countdownElement = document.getElementById('countdown');
    if (countdownElement && typeof countdownInterval === 'undefined') {
      countdownInterval = setInterval(updateCountdown, 1000);
    }
  });

  window.addEventListener("beforeunload", () => {
    clearInterval(countdownInterval);
    countdownInterval = undefined;
  });
  

  document.addEventListener("DOMContentLoaded", () => {
    const countdownElement = document.getElementById('countdown');
    if (countdownElement) {
      countdownInterval = setInterval(updateCountdown, 1000);
    }
  });

  window.addEventListener("beforeunload", () => {
    clearInterval(countdownInterval);
  });
</script>
